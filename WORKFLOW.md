# Git å·¥ä½œæµè¯´æ˜

## ğŸ“‹ åˆ†æ”¯è¯´æ˜

### main åˆ†æ”¯
- **ç”¨é€”**: ç”Ÿäº§ç¯å¢ƒï¼Œç¨³å®šç‰ˆæœ¬
- **ä¿æŠ¤**: ç›´æ¥æ¨é€å—é™ï¼Œå»ºè®®é€šè¿‡ PR åˆå¹¶
- **åŒæ­¥**: è‡ªåŠ¨è§¦å‘ Webhook æ›´æ–° Greasy Fork

### dev åˆ†æ”¯
- **ç”¨é€”**: å¼€å‘ç¯å¢ƒï¼Œæ–°åŠŸèƒ½å¼€å‘
- **å·¥ä½œ**: æ—¥å¸¸å¼€å‘åœ¨æ­¤åˆ†æ”¯è¿›è¡Œ
- **åˆå¹¶**: å¼€å‘å®Œæˆååˆå¹¶åˆ° main

---

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### 1. æ–°åŠŸèƒ½å¼€å‘

```bash
# åˆ‡æ¢åˆ° dev åˆ†æ”¯
git checkout dev

# ä¿®æ”¹ä»£ç 
vim çºªå¿µå¸é¢„çº¦è¾…åŠ©å·¥å…·.user.js

# æ›´æ–°ç‰ˆæœ¬å·ï¼ˆé‡è¦ï¼ï¼‰
# @version      2.1.1

# æäº¤åˆ° dev åˆ†æ”¯
git add .
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"

# æ¨é€åˆ°è¿œç¨‹ dev åˆ†æ”¯
git push origin dev
```

### 2. åˆ›å»º Pull Request

```bash
# ä» dev åˆ†æ”¯åˆ›å»º PR åˆ° main
gh pr create \
  --base main \
  --head dev \
  --title "Release v2.1.1" \
  --body "## æ›´æ–°å†…å®¹
- æ–°åŠŸèƒ½ xxx
- ä¿®å¤ yyy
- ä¼˜åŒ– zzz"
```

### 3. ç‰ˆæœ¬æ£€æŸ¥

GitHub Actions ä¼šè‡ªåŠ¨æ£€æŸ¥ï¼š
- âœ… æºåˆ†æ”¯ï¼ˆdevï¼‰ç‰ˆæœ¬å·
- âœ… ç›®æ ‡åˆ†æ”¯ï¼ˆmainï¼‰ç‰ˆæœ¬å·
- âŒ å¦‚æœç›¸åŒï¼ŒPR åˆå¹¶è¢«é˜»æ­¢

### 4. åˆå¹¶åˆ° main

```bash
# PR å®¡æŸ¥é€šè¿‡ååˆå¹¶
gh pr merge

# æˆ–è€…ä½¿ç”¨ GitHub ç½‘é¡µåˆå¹¶æŒ‰é’®
```

### 5. è‡ªåŠ¨åŒæ­¥

åˆå¹¶åˆ° main åï¼š
- âœ… Webhook è‡ªåŠ¨è§¦å‘
- âœ… Grease Fork è‡ªåŠ¨æ›´æ–°
- âœ… ç”¨æˆ·è‡ªåŠ¨æ”¶åˆ°æ›´æ–°é€šçŸ¥

---

## ğŸš« ç‰ˆæœ¬å·å†²çªå¤„ç†

### å¦‚æœç‰ˆæœ¬å·ç›¸åŒ

GitHub Actions ä¼šæŠ¥é”™ï¼š
```
âŒ é”™è¯¯ï¼šç‰ˆæœ¬å·ç›¸åŒï¼
   è¯·æ›´æ–°æºåˆ†æ”¯çš„ç‰ˆæœ¬å·ï¼ˆ@versionï¼‰
```

### è§£å†³æ–¹æ³•

1. **å›åˆ° dev åˆ†æ”¯**
   ```bash
   git checkout dev
   ```

2. **æ›´æ–°ç‰ˆæœ¬å·**
   ```bash
   # æ–¹å¼ä¸€ï¼šä½¿ç”¨ sed å‘½ä»¤
   sed -i '' 's/@version.*/@version      2.1.2/' çºªå¿µå¸é¢„çº¦è¾…åŠ©å·¥å…·.user.js

   # æ–¹å¼äºŒï¼šæ‰‹åŠ¨ç¼–è¾‘
   vim çºªå¿µå¸é¢„çº¦è¾…åŠ©å·¥å…·.user.js
   # ä¿®æ”¹ @version      2.1.1 â†’ @version      2.1.2
   ```

3. **æäº¤å¹¶æ¨é€**
   ```bash
   git add çºªå¿µå¸é¢„çº¦è¾…åŠ©å·¥å…·.user.js
   git commit -m "bump: ç‰ˆæœ¬å·æ›´æ–°åˆ° 2.1.2"
   git push origin dev
   ```

4. **é‡æ–°æ£€æŸ¥ PR**
   - GitHub Actions ä¼šè‡ªåŠ¨é‡æ–°æ£€æŸ¥
   - å¦‚æœé€šè¿‡ï¼ŒPR å¯ä»¥åˆå¹¶

---

## ğŸ“ ç‰ˆæœ¬å·è§„èŒƒ

å»ºè®®ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼š

```
ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·

ä¾‹å¦‚ï¼š2.1.0
  ä¸»ç‰ˆæœ¬å·ï¼š2  - é‡å¤§æ›´æ–°ï¼ˆä¸å…¼å®¹çš„ä¿®æ”¹ï¼‰
  æ¬¡ç‰ˆæœ¬å·ï¼š1  - æ–°å¢åŠŸèƒ½ï¼ˆå‘åå…¼å®¹ï¼‰
  ä¿®è®¢å·ï¼š0  - Bug ä¿®å¤ï¼ˆå‘åå…¼å®¹ï¼‰

ç¤ºä¾‹ï¼š
  2.1.0 â†’ 2.1.1 (ä¿®å¤ bug)
  2.1.1 â†’ 2.2.0 (æ–°å¢åŠŸèƒ½)
  2.2.0 â†’ 3.0.0 (é‡å¤§æ›´æ–°)
```

---

## ğŸ›¡ï¸ ä¿æŠ¤ main åˆ†æ”¯ï¼ˆå¯é€‰ï¼‰

### åœ¨ GitHub ä¸Šè®¾ç½®åˆ†æ”¯ä¿æŠ¤

1. **è¿›å…¥ä»“åº“è®¾ç½®**
   - Settings â†’ Branches

2. **æ·»åŠ åˆ†æ”¯ä¿æŠ¤è§„åˆ™**
   - Branch name pattern: `main`
   - âœ… Require a pull request before merging
   - âœ… Require status checks to pass before merging
   - âœ… Require branches to be up to date before merging

3. **ä¿å­˜è§„åˆ™**

---

## ğŸ”§ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### æŸ¥çœ‹å½“å‰ç‰ˆæœ¬å·
```bash
grep "@version" çºªå¿µå¸é¢„çº¦è¾…åŠ©å·¥å…·.user.js
```

### æ›´æ–°ç‰ˆæœ¬å·
```bash
# æ›´æ–°åˆ° 2.2.0
sed -i '' 's/@version.*/@version      2.2.0/' çºªå¿µå¸é¢„çº¦è¾…åŠ©å·¥å…·.user.js
```

### æ¯”è¾ƒä¸¤ä¸ªåˆ†æ”¯çš„ç‰ˆæœ¬å·
```bash
# main åˆ†æ”¯ç‰ˆæœ¬
git show main:çºªå¿µå¸é¢„çº¦è¾…åŠ©å·¥å…·.user.js | grep "@version"

# dev åˆ†æ”¯ç‰ˆæœ¬
git show dev:çºªå¿µå¸é¢„çº¦è¾…åŠ©å·¥å…·.user.js | grep "@version"
```

### æŸ¥çœ‹åˆ†æ”¯å·®å¼‚
```bash
git diff main dev -- çºªå¿µå¸é¢„çº¦è¾…åŠ©å·¥å…·.user.js
```

---

## ğŸ“Š å·¥ä½œæµå›¾ç¤º

```
å¼€å‘æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dev    â”‚â”€â”€â”€â”€â–¶â”‚  Commit â”‚â”€â”€â”€â”€â–¶â”‚   PR    â”‚â”€â”€â”€â”€â–¶â”‚  Main   â”‚
â”‚ Branch  â”‚     â”‚         â”‚     â”‚         â”‚     â”‚ Branch  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–³                                    â–³
     â”‚                                    â”‚
[å¼€å‘ç¯å¢ƒ]                           [ç”Ÿäº§ç¯å¢ƒ]
     â”‚                                    â”‚
 v2.1.1                              v2.1.0
     â”‚                                    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    Webhook
                        â”‚
                        â–¼
              [Greasy Fork åŒæ­¥]
                        â”‚
                        â–¼
                  [ç”¨æˆ·è‡ªåŠ¨æ›´æ–°]
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•å¤„ç†ç´§æ€¥ä¿®å¤ï¼Ÿ

å¯¹äº main åˆ†æ”¯çš„ç´§æ€¥ä¿®å¤ï¼š
```bash
# 1. ä» main åˆ›å»º hotfix åˆ†æ”¯
git checkout main
git checkout -b hotfix/fix-bug

# 2. ä¿®å¤å¹¶æäº¤
git add .
git commit -m "fix: ä¿®å¤ç´§æ€¥ bug"

# 3. åˆ›å»º PR åˆ° main
gh pr create --base main --head hotfix/fix-bug

# 4. åˆå¹¶ååˆ é™¤ hotfix åˆ†æ”¯
git checkout main
git branch -d hotfix/fix-bug
```

### Q2: å¿˜è®°æ›´æ–°ç‰ˆæœ¬å·æ€ä¹ˆåŠï¼Ÿ

GitHub Actions ä¼šè‡ªåŠ¨é˜»æ­¢ PRï¼Œæ‚¨éœ€è¦ï¼š
1. æ›´æ–° dev åˆ†æ”¯çš„ç‰ˆæœ¬å·
2. æ¨é€åˆ° GitHub
3. PR ä¼šè‡ªåŠ¨é‡æ–°æ£€æŸ¥

### Q3: å¦‚ä½•è·³è¿‡ç‰ˆæœ¬æ£€æŸ¥ï¼Ÿ

ä¸æ¨èï¼ä½†ç´§æ€¥æƒ…å†µä¸‹å¯ä»¥ï¼š
1. åœ¨ main åˆ†æ”¯ç›´æ¥ä¿®æ”¹ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
2. æ›´æ–°ç‰ˆæœ¬å·åæäº¤

---

## ğŸ¯ æœ€ä½³å®è·µ

1. âœ… **æ°¸è¿œåœ¨ dev åˆ†æ”¯å¼€å‘**
2. âœ… **æ¯æ¬¡ä¿®æ”¹éƒ½æ›´æ–°ç‰ˆæœ¬å·**
3. âœ… **ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·**
4. âœ… **ç¼–å†™æ¸…æ™°çš„æäº¤ä¿¡æ¯**
5. âœ… **PR æè¿°è¦è¯¦ç»†**
6. âœ… **åˆå¹¶å‰æ£€æŸ¥å·®å¼‚**
7. âœ… **å®šæœŸåŒæ­¥ main åˆ° dev**ï¼ˆè·å–æœ€æ–°ä¿®å¤ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **Workflow**: `.github/workflows/check-version-conflict.yml`
- **Hook**: `.git/hooks/pre-merge`
- **æ–‡æ¡£**: `WORKFLOW.md`

---

**ç”Ÿæˆæ—¶é—´**: 2026-01-09
**ç‰ˆæœ¬**: 1.0
